{% extends 'base.html' %}
{% load static %}

{% block title %}
    Action Page
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'action.css' %}">
{% endblock %}

{% block content %}
<main class="action-page">
    <!-- Daily Ongoing Tasks -->
    <section>
        <h1>Daily Ongoing Tasks</h1>
        <p class="lead text-body-secondary">
            These tasks have no deadlines and can be completed multiple times throughout the school year!
        </p>
    </section>
    <div class="events-container">
        {% for task in ongoing_tasks %}
            <section class="events">
                <div class="events-image">
                    <img src="{% static task.image %}" alt="Event Image"
                         onerror="this.onerror=null; this.src='{% static 'noimage.png' %}';" />
                    <button class="pin-icon" onclick="togglePin(this)">
                        <img src="{% static 'pin.png' %}" alt="Pin Icon" />
                    </button>
                </div>
                <div class="events-info">
                    <h2 class="name">{{ task.name }}</h2>
                    <p class="points">Points: {{ task.points }}pts</p>
                    <p class="date">Time: {{ task.time }}</p>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">See Description</button>
                    </div>
                </div>
            </section>
        {% endfor %}
    </div>

    <!-- Events and Speakers -->
    <section>
        <h1>Events and Speakers</h1>
        <p class="lead text-body-secondary">
            We invite students to come to these informational events about sustainability!
        </p>
    </section>
    <div class="events-container">
        {% for event in events %}
            <section class="events">
                <div class="events-image">
                    <img src="{% static event.image %}" alt="Event Image"
                         onerror="this.onerror=null; this.src='{% static 'noimage.png' %}';" />
                    <button class="pin-icon" onclick="togglePin(this)">
                        <img src="{% static 'pin.png' %}" alt="Pin Icon" />
                    </button>
                </div>
                <div class="events-info">
                    <h2 class="name">{{ event.name }}</h2>
                    <p class="points">Points: {{ event.points }}pts</p>
                    <p class="date">Time: {{ event.date }}</p>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">See Description</button>
                    </div>
                </div>
            </section>
        {% endfor %}
    </div>

    <!-- Volunteer Work -->
    <section>
        <h1>Volunteer Work</h1>
        <p class="lead text-body-secondary">
            Here are some opportunities for students to volunteer!
        </p>
    </section>
    <div class="events-container">
        {% for volunteer in volunteer_work %}
            <section class="events">
                <div class="events-image">
                    <img src="{% static volunteer.image %}" alt="Event Image"
                         onerror="this.onerror=null; this.src='{% static 'noimage.png' %}';" />
                    <button class="pin-icon" onclick="togglePin(this)">
                        <img src="{% static 'pin.png' %}" alt="Pin Icon" />
                    </button>
                </div>
                <div class="events-info">
                    <h2 class="name">{{ volunteer.name }}</h2>
                    <p class="points">Points: {{ volunteer.points }}pts</p>
                    <p class="date">Time: {{ volunteer.date }}</p>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">See Description</button>
                    </div>
                </div>
            </section>
        {% endfor %}
    </div>

    <!-- Team and Individual Challenges -->
    <section>
        <h1>Team and Individual Challenges</h1>
        <p class="lead text-body-secondary">
            There are currently no challenges available!
        </p>
    </section>
</main>
{% endblock %}

{% block footer %}
    <footer>
        <p>&copy; 2024 BC Sustain. All rights reserved.</p>
    </footer>
{% endblock %}

{% block scripts %}
    <script>
        function togglePin(button) {
            button.classList.toggle("pinned");
            const img = button.querySelector('img');
            if (button.classList.contains("pinned")) {
                img.src = "{% static 'pinned-icon.png' %}";
            } else {
                img.src = "{% static 'pin.png' %}";
            }
            const isPinned = button.classList.contains("pinned");
            localStorage.setItem("pinnedState", isPinned);
        }

        document.addEventListener("DOMContentLoaded", function () {
            const pinState = localStorage.getItem("pinnedState");
            const pinButton = document.querySelector(".pin-icon");
            if (pinState === "true") {
                pinButton.classList.add("pinned");
                pinButton.querySelector('img').src = "{% static 'pinned-icon.png' %}";
            }
        });
    </script>
{% endblock %}
